window.getLocate = function(callback){
	var _point = {
    		provinces:[{
		      "id": 107,
		      "isDeleted": 0,
		      "provinceId": "5",
		      "provinceName": "江苏",
		      "showOrder": 97,
		      "site": "2"
		    }, {
		      "id": 110,
		      "isDeleted": 0,
		      "provinceId": "14",
		      "provinceName": "福建",
		      "showOrder": 0,
		      "site": "3"
		    }, {
		      "id": 112,
		      "isDeleted": 0,
		      "provinceId": "16",
		      "provinceName": "山东",
		      "showOrder": 90,
		      "site": "1"
		    }, {
		      "id": 99,
		      "isDeleted": 0,
		      "provinceId": "3",
		      "provinceName": "天津",
		      "showOrder": 94,
		      "site": "1"
		    }, {
		      "id": 123,
		      "isDeleted": 0,
		      "provinceId": "25",
		      "provinceName": "西藏",
		      "showOrder": 0,
		      "site": "3"
		    }, {
		      "id": 120,
		      "isDeleted": 0,
		      "provinceId": "12",
		      "provinceName": "四川",
		      "showOrder": 95,
		      "site": "3"
		    }, {
		      "id": 98,
		      "isDeleted": 0,
		      "provinceId": "2",
		      "provinceName": "北京",
		      "showOrder": 99,
		      "site": "1"
		    }, {
		      "id": 126,
		      "isDeleted": 0,
		      "provinceId": "28",
		      "provinceName": "青海",
		      "showOrder": 0,
		      "site": "2"
		    }, {
		      "id": 104,
		      "isDeleted": 0,
		      "provinceId": "10",
		      "provinceName": "吉林",
		      "showOrder": 82,
		      "site": "2"
		    }, {
		      "id": 121,
		      "isDeleted": 0,
		      "provinceId": "23",
		      "provinceName": "贵州",
		      "showOrder": 93,
		      "site": "3"
		    }, {
		      "id": 125,
		      "isDeleted": 0,
		      "provinceId": "27",
		      "provinceName": "甘肃",
		      "showOrder": 0,
		      "site": "2"
		    }, {
		      "id": 108,
		      "isDeleted": 0,
		      "provinceId": "6",
		      "provinceName": "浙江",
		      "showOrder": 96,
		      "site": "2"
		    }, {
		      "id": 100,
		      "isDeleted": 0,
		      "provinceId": "4",
		      "provinceName": "河北",
		      "showOrder": 78,
		      "site": "1"
		    }, {
		      "id": 127,
		      "isDeleted": 0,
		      "provinceId": "30",
		      "provinceName": "宁夏",
		      "showOrder": 0,
		      "site": "2"
		    }, {
		      "id": 113,
		      "isDeleted": 0,
		      "provinceId": "17",
		      "provinceName": "河南",
		      "showOrder": 89,
		      "site": "2"
		    }, {
		      "id": 119,
		      "isDeleted": 0,
		      "provinceId": "7",
		      "provinceName": "重庆",
		      "showOrder": 84,
		      "site": "3"
		    }, {
		      "id": 124,
		      "isDeleted": 0,
		      "provinceId": "26",
		      "provinceName": "陕西",
		      "showOrder": 91,
		      "site": "1"
		    }, {
		      "id": 105,
		      "isDeleted": 0,
		      "provinceId": "11",
		      "provinceName": "黑龙江",
		      "showOrder": 83,
		      "site": "2"
		    }, {
		      "id": 109,
		      "isDeleted": 0,
		      "provinceId": "13",
		      "provinceName": "安徽",
		      "showOrder": 0,
		      "site": "2"
		    }, {
		      "id": 115,
		      "isDeleted": 0,
		      "provinceId": "19",
		      "provinceName": "湖南",
		      "showOrder": 87,
		      "site": "3"
		    }, {
		      "id": 122,
		      "isDeleted": 0,
		      "provinceId": "24",
		      "provinceName": "云南",
		      "showOrder": 92,
		      "site": "3"
		    }, {
		      "id": 111,
		      "isDeleted": 0,
		      "provinceId": "15",
		      "provinceName": "江西",
		      "showOrder": 0,
		      "site": "3"
		    }, {
		      "id": 102,
		      "isDeleted": 0,
		      "provinceId": "8",
		      "provinceName": "内蒙古",
		      "showOrder": 80,
		      "site": "2"
		    }, {
		      "id": 103,
		      "isDeleted": 0,
		      "provinceId": "9",
		      "provinceName": "辽宁",
		      "showOrder": 81,
		      "site": "1"
		    }, {
		      "id": 106,
		      "isDeleted": 0,
		      "provinceId": "1",
		      "provinceName": "上海",
		      "showOrder": 100,
		      "site": "2"
		    }, {
		      "id": 114,
		      "isDeleted": 0,
		      "provinceId": "18",
		      "provinceName": "湖北",
		      "showOrder": 88,
		      "site": "3"
		    }, {
		      "id": 118,
		      "isDeleted": 0,
		      "provinceId": "22",
		      "provinceName": "海南",
		      "showOrder": 85,
		      "site": "3"
		    }, {
		      "id": 101,
		      "isDeleted": 0,
		      "provinceId": "32",
		      "provinceName": "山西",
		      "showOrder": 79,
		      "site": "2"
		    }, {
		      "id": 128,
		      "isDeleted": 0,
		      "provinceId": "29",
		      "provinceName": "新疆",
		      "showOrder": 0,
		      "site": "2"
		    }, {
		      "id": 116,
		      "isDeleted": 0,
		      "provinceId": "20",
		      "provinceName": "广东",
		      "showOrder": 98,
		      "site": "3"
		    }, {
		      "id": 117,
		      "isDeleted": 0,
		      "provinceId": "21",
		      "provinceName": "广西",
		      "showOrder": 86,
		      "site": "3"
		    }
		],
		getLocateInfo: function(cb){
				//var url = 'https://api.map.baidu.com/location/ip?ak=O7SW2G7ulgM2dOTfodwPo7F2LWRO1FBU'
				var url='//pubapi.111.com.cn/api/location/ip?ip=client';
		        jQuery.ajax({
		            url:url,
		            dataType:'jsonp',
		            type:'get',
		            success:function(res){
		              var r = res;
					  if(!r || r.status != '0'){						
					  	return false;
					  }
					  if(!r.content ||!r.content.address_detail){
					  	return false;
					  }
		              if(r.content.address_detail.province && r.content.address_detail.city){

		              	var p = r.content.address_detail.province;
						p=p.replace('市','');
						p=p.replace('省','');
		              	var c = r.content.address_detail.city;
		              	c = c.replace('市','');
						var provinces= _point.provinces;
						var province=null;
						for(var i=0;i<provinces.length;i++){
							if(provinces[i].provinceName==p){
								province=provinces[i];
							}
						}
		                jQuery.cookie('locateProvinceId',province.provinceId, {expires:0.042,path: '/',domain: '.111.com.cn'});
		                jQuery.cookie('locateProvinceName',province.provinceName,{expires:0.042,path: '/',domain: '.111.com.cn'});
		                jQuery.cookie('locateCityName',c,{expires:0.042,path: '/',domain: '.111.com.cn'});
						jQuery.cookie("cityName",c,{expires:0.042,path: '/',domain: '.111.com.cn'});//搜索有人用到这个cookie	
						window.remote_ip_info={};
						window.remote_ip_info.province=province.provinceName;
						window.remote_ip_info.city=c;
		                if(cb){
		                	if(cb.bind){
		                		cb.bind(_point)()
		                	} else {
		                		cb()
		                	}
		                	
		                };
		              }
		            },
					error:function(e){
						console.log(e);
					}
		        })
			}
	}
	if(callback){
		_point.getLocateInfo(callback);
	}else{
		_point.getLocateInfo();
	}
}
jQuery(function(){
	if(!jQuery.cookie('locateProvinceId') || !jQuery.cookie('locateProvinceName')|| !jQuery.cookie('locateCityName')){		
		window.getLocate();		
	}
})